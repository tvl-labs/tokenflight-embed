---
import config from 'virtual:starlight/user-config';
import LanguageSelect from 'virtual:starlight/components/LanguageSelect';
import Search from 'virtual:starlight/components/Search';
import SocialIcons from 'virtual:starlight/components/SocialIcons';
import ThemeSelect from 'virtual:starlight/components/ThemeSelect';
import logoSrc from '../assets/logo.svg';

const shouldRenderSearch =
	config.pagefind || config.components.Search !== '@astrojs/starlight/components/Search.astro';

const { siteTitleHref } = Astro.locals.starlightRoute;

const navItems = [
	{ label: 'Docs', href: '/getting-started/' },
	{ label: 'API', href: 'https://khalani.gitbook.io/khalani-docs/api-reference' },
	{ label: 'Examples', href: '/examples/vanilla/' },
];
---

<div class="header tf-header">
	{/* Logo */}
	<a href={siteTitleHref} class="tf-header-brand">
		<span class="tf-logo-icon">
			<img src={logoSrc.src} width="18" height="18" alt="TokenFlight" />
		</span>
		<span class="tf-logo-text">TokenFlight</span>
		<span class="tf-logo-tag">SDK</span>
	</a>

	{/* Divider */}
	<div class="tf-header-divider"></div>

	{/* Nav links */}
	<nav class="tf-header-nav">
		{navItems.map((item) => (
			<a href={item.href} class="tf-nav-link">{item.label}</a>
		))}
	</nav>

	{/* Search */}
	<div class="tf-header-search sl-flex print:hidden">
		{shouldRenderSearch && <Search />}
	</div>

	{/* Right actions */}
	<div class="tf-header-actions print:hidden">
		<div class="tf-header-social">
			<SocialIcons />
		</div>
		<ThemeSelect />
		<LanguageSelect />
	</div>
</div>

<script is:inline>
	(() => {
		const header = document.querySelector('header.header');
		if (!header) return;
		const onScroll = () => {
			if (window.scrollY > 8) {
				header.setAttribute('data-scrolled', '');
			} else {
				header.removeAttribute('data-scrolled');
			}
		};
		window.addEventListener('scroll', onScroll, { passive: true });
		onScroll();
	})();
</script>

<style>
	.tf-header {
		display: flex;
		align-items: center;
		height: 100%;
		padding: 0 24px;
		gap: 8px;
		position: relative;
	}

	/* Logo brand */
	.tf-header-brand {
		display: flex;
		align-items: center;
		gap: 10px;
		text-decoration: none;
		flex-shrink: 0;
		padding: 4px 2px;
		border-radius: 8px;
		transition: opacity 150ms ease;
	}

	.tf-header-brand:hover {
		opacity: 0.8;
	}

	.tf-logo-icon {
		width: 30px;
		height: 30px;
		border-radius: 8px;
		display: flex;
		align-items: center;
		justify-content: center;
		background: linear-gradient(135deg, var(--tf-header-accent, #8B7CF6), #5B4CC4);
		overflow: hidden;
	}

	.tf-logo-icon img {
		width: 18px;
		height: 18px;
	}

	.tf-logo-text {
		font-size: 15px;
		font-weight: 700;
		letter-spacing: -0.02em;
		line-height: 1;
		color: var(--tf-header-text, #EEF0F6);
	}

	.tf-logo-tag {
		font-size: 10px;
		font-weight: 600;
		padding: 2px 6px;
		border-radius: 5px;
		letter-spacing: 0.02em;
		line-height: 1;
		margin-left: -2px;
		background: var(--tf-header-tag-bg, rgba(139, 124, 246, 0.1));
		color: var(--tf-header-accent, #8B7CF6);
	}

	/* Divider */
	.tf-header-divider {
		width: 1px;
		height: 20px;
		margin: 0 8px;
		flex-shrink: 0;
		background: var(--tf-header-border, #2A2F3F);
	}

	/* Nav links */
	.tf-header-nav {
		display: flex;
		align-items: center;
		gap: 2px;
	}

	.tf-nav-link {
		font-size: 13px;
		font-weight: 500;
		padding: 5px 12px;
		border-radius: 7px;
		text-decoration: none;
		transition: color 150ms ease, background 150ms ease;
		white-space: nowrap;
		color: var(--tf-header-text-secondary, #8B93A5);
	}

	.tf-nav-link:hover {
		color: var(--tf-header-text, #EEF0F6);
		background: var(--tf-header-hover-bg, rgba(139, 124, 246, 0.06));
	}

	/* Search area */
	.tf-header-search {
		margin-left: auto;
		flex-shrink: 1;
	}

	/* Right actions */
	.tf-header-actions {
		display: flex;
		align-items: center;
		gap: 4px;
		flex-shrink: 0;
		margin-left: 8px;
	}

	.tf-header-social {
		display: flex;
		align-items: center;
	}

	/* Hide social-icons separator from Starlight default */
	.tf-header-social :global(.social-icons::after) {
		display: none;
	}

	/* Mobile: hide nav, divider, actions */
	@media (max-width: 50rem) {
		.tf-header-divider,
		.tf-header-nav,
		.tf-header-actions {
			display: none;
		}

		.tf-header {
			padding: 0 16px;
		}

		.tf-logo-tag {
			display: none;
		}
	}

	@media (max-width: 480px) {
		.tf-header-search {
			display: none;
		}
	}
</style>
