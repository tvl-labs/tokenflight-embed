---
/**
 * Mock chat application with an embedded TokenFlight receive widget.
 * Demonstrates how a payment request looks in a Telegram/WeChat-style messenger.
 */
---

<div class="ch-demo not-content">
  <!-- Chat header -->
  <div class="ch-header">
    <button class="ch-back">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
    </button>
    <div class="ch-contact">
      <div class="ch-contact-avatar" style="background: linear-gradient(135deg, #0088cc, #54a0ff);">A</div>
      <div class="ch-contact-info">
        <span class="ch-contact-name">Alice</span>
        <span class="ch-contact-status">online</span>
      </div>
    </div>
    <div class="ch-header-actions">
      <button class="ch-header-btn">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
      </button>
      <button class="ch-header-btn">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg>
      </button>
    </div>
  </div>

  <!-- Chat messages -->
  <div class="ch-messages">
    <!-- Date separator -->
    <div class="ch-date-sep"><span>Today</span></div>

    <!-- Incoming text messages -->
    <div class="ch-msg ch-msg--in">
      <div class="ch-bubble">
        <p>Hey! Can you send me the payment for dinner last night?</p>
        <span class="ch-msg-time">10:24 AM</span>
      </div>
    </div>

    <div class="ch-msg ch-msg--in">
      <div class="ch-bubble">
        <p>It was $25 total for my share</p>
        <span class="ch-msg-time">10:24 AM</span>
      </div>
    </div>

    <!-- Outgoing message -->
    <div class="ch-msg ch-msg--out">
      <div class="ch-bubble">
        <p>Sure! What chain do you want it on?</p>
        <span class="ch-msg-time">10:26 AM</span>
      </div>
    </div>

    <!-- Incoming message with widget -->
    <div class="ch-msg ch-msg--in">
      <div class="ch-bubble">
        <p>Just use this link, you can pay from any chain:</p>
        <span class="ch-msg-time">10:27 AM</span>
      </div>
    </div>

    <!-- Widget card as a special message -->
    <div class="ch-msg ch-msg--in">
      <div class="ch-bubble ch-bubble--widget">
        <div class="ch-widget-header">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
          <span>Payment Request</span>
        </div>
        <div class="ch-mount" data-widget="receive"></div>
        <span class="ch-msg-time">10:27 AM</span>
      </div>
    </div>
  </div>

  <!-- Chat input bar -->
  <div class="ch-input-bar">
    <button class="ch-input-btn">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/></svg>
    </button>
    <input class="ch-input" type="text" placeholder="Message" readonly />
    <button class="ch-input-btn ch-send-btn">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </button>
  </div>
</div>

<script>
  import { TokenFlightReceive, registerElements } from '@tokenflight/swap';
  import { getWalletAdapter } from '../lib/appkit';

  registerElements();

  const walletAdapter = await getWalletAdapter();

  document.querySelectorAll('.ch-demo').forEach((root) => {
    const el = root as HTMLElement;
    const receiveMount = el.querySelector('[data-widget="receive"]') as HTMLElement | null;

    if (receiveMount) {
      const receive = new TokenFlightReceive({
        container: receiveMount,
        config: {
          target: { chainId: 8453, address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' },
          amount: '25',
          theme: 'dark',
          locale: 'en-US',
          hideTitle: true,
        },
        walletAdapter: walletAdapter ?? undefined,
        callbacks: {
          onSwapSuccess: (data: unknown) => console.log('Payment success:', data),
          onSwapError: (data: unknown) => console.log('Payment error:', data),
        },
      });
      receive.initialize();
      receive.setCustomColors({
        primary: '#6AB2F2',
        'accent-light': 'rgba(106, 178, 242, 0.1)',
        'accent-glow': 'rgba(106, 178, 242, 0.2)',
      });
    }
  });
</script>

<style>
  /* ── Chat Shell ────────────────────────────────────────────────── */
  .ch-demo {
    max-width: 420px;
    margin: 1.5rem auto;
    background: #0E1621;
    border-radius: 16px;
    border: 1px solid #1E2C3A;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: #E7E9EA;
    display: flex;
    flex-direction: column;
  }

  /* ── Header ────────────────────────────────────────────────────── */
  .ch-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 12px;
    background: #17212B;
    border-bottom: 1px solid #1E2C3A;
    flex-shrink: 0;
  }

  .ch-back {
    background: none;
    border: none;
    color: #6AB2F2;
    cursor: pointer;
    padding: 4px;
    border-radius: 6px;
    display: flex;
    align-items: center;
  }

  .ch-back:hover { background: rgba(106, 178, 242, 0.1); }

  .ch-contact {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
  }

  .ch-contact-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: 700;
    color: #fff;
  }

  .ch-contact-info { display: flex; flex-direction: column; }

  .ch-contact-name {
    font-size: 14px;
    font-weight: 600;
    color: #E7E9EA;
  }

  .ch-contact-status {
    font-size: 12px;
    color: #6AB2F2;
  }

  .ch-header-actions {
    display: flex;
    gap: 4px;
  }

  .ch-header-btn {
    background: none;
    border: none;
    color: #6AB2F2;
    cursor: pointer;
    padding: 6px;
    border-radius: 6px;
    display: flex;
    align-items: center;
  }

  .ch-header-btn:hover { background: rgba(106, 178, 242, 0.1); }

  /* ── Messages ──────────────────────────────────────────────────── */
  .ch-messages {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    background:
      radial-gradient(ellipse at 30% 20%, rgba(106, 178, 242, 0.03) 0%, transparent 50%),
      #0E1621;
  }

  .ch-date-sep {
    text-align: center;
    padding: 8px 0;
  }

  .ch-date-sep span {
    font-size: 12px;
    color: #6C7883;
    background: rgba(23, 33, 43, 0.9);
    padding: 3px 10px;
    border-radius: 10px;
  }

  .ch-msg {
    display: flex;
    max-width: 85%;
  }

  .ch-msg:has(.ch-bubble--widget) {
    max-width: 100%;
  }

  .ch-msg--in { align-self: flex-start; }
  .ch-msg--out { align-self: flex-end; }

  .ch-bubble {
    padding: 8px 12px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.45;
    position: relative;
  }

  .ch-msg--in .ch-bubble {
    background: #182533;
    border-bottom-left-radius: 4px;
  }

  .ch-msg--out .ch-bubble {
    background: #2B5278;
    border-bottom-right-radius: 4px;
  }

  .ch-bubble p {
    margin: 0;
    color: #E7E9EA;
  }

  .ch-msg-time {
    display: block;
    font-size: 11px;
    color: #6C7883;
    text-align: right;
    margin-top: 4px;
  }

  .ch-msg--out .ch-msg-time {
    color: rgba(255, 255, 255, 0.45);
  }

  /* ── Widget bubble ─────────────────────────────────────────────── */
  .ch-bubble--widget {
    padding: 0;
    overflow: hidden;
    width: 100%;
  }

  .ch-widget-header {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 600;
    color: #6AB2F2;
    border-bottom: 1px solid rgba(106, 178, 242, 0.1);
  }

  .ch-widget-header svg { color: #6AB2F2; flex-shrink: 0; }

  .ch-bubble--widget .ch-msg-time {
    padding: 4px 12px 8px;
  }

  .ch-mount {
    min-height: 200px;
  }

  /* ── Input bar ─────────────────────────────────────────────────── */
  .ch-input-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: #17212B;
    border-top: 1px solid #1E2C3A;
    flex-shrink: 0;
  }

  .ch-input {
    flex: 1;
    background: #242F3D;
    border: none;
    border-radius: 20px;
    padding: 10px 16px;
    color: #E7E9EA;
    font-size: 14px;
    font-family: inherit;
    outline: none;
  }

  .ch-input::placeholder { color: #6C7883; }

  .ch-input-btn {
    background: none;
    border: none;
    color: #6C7883;
    cursor: pointer;
    padding: 6px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .ch-input-btn:hover { color: #6AB2F2; }

  .ch-send-btn { color: #6AB2F2; }
</style>
