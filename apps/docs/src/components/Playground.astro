---
/* Playground.astro — RainbowKit-inspired interactive playground */
---

<div class="pg-playground not-content" id="pg-root">
  <div class="pg-container">
    <!-- ─── Widget Preview (hero position) ─── -->
    <div class="pg-widget">
      <div class="pg-widget-mount" id="pg-widget-mount"></div>
    </div>

    <!-- ─── Controls Strip ─── -->
    <div class="pg-strip">
      <!-- Mode: Swap / Receive -->
      <div class="pg-group">
        <span class="pg-label">Mode</span>
        <div class="pg-pills">
          <button class="pg-pill pg-pill--active" data-mode="swap">Swap</button>
          <button class="pg-pill" data-mode="receive">Receive</button>
        </div>
      </div>

      <!-- Theme: Light / Dark -->
      <div class="pg-group">
        <span class="pg-label">Theme</span>
        <div class="pg-pills">
          <button class="pg-pill pg-pill--icon" data-theme-btn="light" title="Light">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
          </button>
          <button class="pg-pill pg-pill--icon pg-pill--active" data-theme-btn="dark" title="Dark">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          </button>
        </div>
      </div>

      <!-- Accent Color -->
      <div class="pg-group">
        <span class="pg-label">Accent</span>
        <div class="pg-dots">
          <label class="pg-dot-wrap" title="Default">
            <input type="radio" name="pg-accent" value="#6C5CE7" checked />
            <span class="pg-dot" style="background:#6C5CE7"></span>
          </label>
          <label class="pg-dot-wrap" title="X">
            <input type="radio" name="pg-accent" value="#000000" />
            <span class="pg-dot" style="background:#000000"></span>
          </label>
          <label class="pg-dot-wrap" title="Bsky">
            <input type="radio" name="pg-accent" value="#1185FE" />
            <span class="pg-dot" style="background:#1185FE"></span>
          </label>
          <label class="pg-dot-wrap" title="pump.fun">
            <input type="radio" name="pg-accent" value="#55D292" />
            <span class="pg-dot" style="background:#55D292"></span>
          </label>
          <label class="pg-dot-wrap" title="Uniswap">
            <input type="radio" name="pg-accent" value="#FF007A" />
            <span class="pg-dot" style="background:#FF007A"></span>
          </label>
          <label class="pg-dot-wrap pg-dot-wrap--custom" title="Custom">
            <input type="radio" name="pg-accent" value="custom" />
            <span class="pg-dot pg-dot--custom">
              <svg viewBox="0 0 24 24" width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22l1-1h3l9-9-3-3-9 9v3l-1 1z"/><path d="M15 6l3-3 3 3-3 3"/></svg>
            </span>
            <input type="color" class="pg-color-picker" id="pg-custom-color" value="#E040FB" />
          </label>
        </div>
      </div>

      <!-- Language -->
      <div class="pg-group">
        <span class="pg-label">Language</span>
        <div class="pg-pills">
          <button class="pg-pill pg-pill--sm pg-pill--active" data-lang="en-US">EN</button>
          <button class="pg-pill pg-pill--sm" data-lang="zh-CN">中</button>
          <button class="pg-pill pg-pill--sm" data-lang="zh-TW">繁</button>
          <button class="pg-pill pg-pill--sm" data-lang="ja-JP">日</button>
          <button class="pg-pill pg-pill--sm" data-lang="ko-KR">한</button>
        </div>
      </div>

      <!-- Display toggles -->
      <div class="pg-group">
        <span class="pg-label">Display</span>
        <div class="pg-pills">
          <button class="pg-pill pg-pill--icon pg-pill--toggle" id="pg-toggle-title" data-tooltip="Hide title">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7V4h16v3"/><path d="M9 20h6"/><path d="M12 4v16"/></svg>
          </button>
          <button class="pg-pill pg-pill--icon pg-pill--toggle" id="pg-toggle-badge" data-tooltip="Hide badge">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="6"/><path d="M8.21 13.89L7 23l5-3 5 3-1.21-9.12"/></svg>
          </button>
          <button class="pg-pill pg-pill--icon pg-pill--toggle" id="pg-toggle-bg" data-tooltip="No background">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" fill-opacity="0.3"/></svg>
          </button>
          <button class="pg-pill pg-pill--icon pg-pill--toggle" id="pg-toggle-border" data-tooltip="No border">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 5V3h2"/><path d="M19 3h2v2"/><path d="M21 19v2h-2"/><path d="M5 21H3v-2"/></svg>
          </button>
        </div>
      </div>

      <!-- Spacer + View Code -->
      <div class="pg-group pg-group--end">
        <button class="pg-code-btn" id="pg-view-code-btn" title="View code">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
          <span>Code</span>
        </button>
      </div>
    </div>

    <!-- ─── Advanced Options (collapsible) ─── -->
    <div class="pg-advanced" id="pg-advanced" hidden>
      <div class="pg-adv-inner">
        <div class="pg-adv-group">
          <span class="pg-label">Title</span>
          <div class="pg-adv-row">
            <input type="text" class="pg-input" id="pg-title-text" placeholder="Title text" />
            <input type="text" class="pg-input" id="pg-title-image" placeholder="Title image URL" />
          </div>
        </div>

        <!-- Swap-specific -->
        <div class="pg-adv-group pg-swap-props" id="pg-swap-props">
          <span class="pg-label">Tokens</span>
          <div class="pg-adv-row">
            <select class="pg-select" id="pg-from-token">
              <option value="">From: User picks</option>
              <option value="eip155:1:0x0000000000000000000000000000000000000000">ETH — Ethereum</option>
              <option value="eip155:1:0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48">USDC — Ethereum</option>
              <option value="eip155:1:0xdAC17F958D2ee523a2206206994597C13D831ec7">USDT — Ethereum</option>
              <option value="eip155:8453:0x0000000000000000000000000000000000000000">ETH — Base</option>
              <option value="eip155:42161:0x0000000000000000000000000000000000000000">ETH — Arbitrum</option>
              <option value="eip155:137:0x0000000000000000000000000000000000000000">POL — Polygon</option>
            </select>
            <select class="pg-select" id="pg-to-token">
              <option value="" selected>To: User picks</option>
              <option value="eip155:8453:0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913">USDC — Base</option>
              <option value="eip155:1:0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48">USDC — Ethereum</option>
              <option value="eip155:42161:0xaf88d065e77c8cC2239327C5EDb3A432268e5831">USDC — Arbitrum</option>
              <option value="eip155:1:0x0000000000000000000000000000000000000000">ETH — Ethereum</option>
              <option value="eip155:8453:0x0000000000000000000000000000000000000000">ETH — Base</option>
            </select>
          </div>
        </div>

        <!-- Receive-specific -->
        <div class="pg-adv-group pg-receive-props" id="pg-receive-props" style="display:none">
          <span class="pg-label">Target</span>
          <div class="pg-adv-row">
            <select class="pg-select" id="pg-target-token">
              <option value="eip155:8453:0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913" selected>USDC — Base</option>
              <option value="eip155:1:0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48">USDC — Ethereum</option>
              <option value="eip155:42161:0xaf88d065e77c8cC2239327C5EDb3A432268e5831">USDC — Arbitrum</option>
              <option value="eip155:1:0xdAC17F958D2ee523a2206206994597C13D831ec7">USDT — Ethereum</option>
              <option value="eip155:1:0x0000000000000000000000000000000000000000">ETH — Ethereum</option>
            </select>
            <input type="text" class="pg-input" id="pg-amount" value="100" placeholder="Amount" />
          </div>
        </div>
      </div>
    </div>

    <!-- Advanced toggle -->
    <button class="pg-adv-toggle" id="pg-adv-toggle">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      <span>More options</span>
    </button>
  </div>

  <!-- ─── Code Modal ─── -->
  <div class="pg-code-modal" id="pg-code-modal" aria-hidden="true">
    <div class="pg-code-modal-backdrop" id="pg-code-modal-backdrop"></div>
    <div class="pg-code-modal-content">
      <div class="pg-code-modal-header">
        <div class="pg-code-bar-left">
          <div class="pg-code-tabs">
            <button class="pg-code-tab pg-code-tab--active" data-tab="html">HTML</button>
            <button class="pg-code-tab" data-tab="react">React</button>
            <button class="pg-code-tab" data-tab="vue">Vue</button>
          </div>
          <div class="pg-code-tabs pg-code-usage" id="pg-code-usage">
            <button class="pg-code-tab pg-code-tab--active" data-usage="imperative">Imperative</button>
            <button class="pg-code-tab" data-usage="declarative">Declarative</button>
          </div>
        </div>
        <div class="pg-code-modal-actions">
          <button class="pg-copy-btn" id="pg-copy-btn" title="Copy to clipboard">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
            <span class="pg-copy-label">Copy</span>
          </button>
          <button class="pg-code-modal-close" id="pg-code-modal-close" aria-label="Close code preview">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
      </div>
      <div class="pg-code-scroll">
        <pre class="pg-pre"><code id="pg-code-output"></code></pre>
      </div>
    </div>
  </div>
</div>

<script>
  import { TokenFlightSwap, TokenFlightReceive, registerElements } from '@tokenflight/swap';
  import { getWalletAdapter, syncAppKitTheme } from '../lib/appkit';
  import Prism from 'prismjs';
  import 'prismjs/components/prism-markup';
  import 'prismjs/components/prism-javascript';
  import 'prismjs/components/prism-jsx';

  registerElements();

  const walletAdapter = await getWalletAdapter();

  /* ── State ── */
  const state = {
    mode: 'swap' as 'swap' | 'receive',
    accent: '#6C5CE7',
    customColor: '#E040FB',
    language: 'en-US',
    hideTitle: false,
    hidePoweredBy: false,
    noBackground: false,
    noBorder: false,
    titleText: '',
    titleImageUrl: '',
    codeTab: 'html' as 'html' | 'react' | 'vue',
    codeUsage: 'imperative' as 'imperative' | 'declarative',
    fromToken: '',
    toToken: '',
    targetToken: 'eip155:8453:0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913',
    amount: '100',
  };

  /* ── DOM refs ── */
  const root = document.getElementById('pg-root')!;
  const mount = document.getElementById('pg-widget-mount')!;
  const codeOutput = document.getElementById('pg-code-output')!;
  const copyBtn = document.getElementById('pg-copy-btn')!;
  const copyLabel = copyBtn.querySelector('.pg-copy-label')!;
  const codeUsageContainer = document.getElementById('pg-code-usage')!;
  const codeModal = document.getElementById('pg-code-modal')!;
  const advPanel = document.getElementById('pg-advanced')!;

  let widget: InstanceType<typeof TokenFlightSwap> | InstanceType<typeof TokenFlightReceive> | null = null;

  /* ── Modal ── */
  function openCodeModal() {
    updateCode();
    codeModal.setAttribute('aria-hidden', 'false');
    codeModal.classList.add('pg-code-modal--open');
    document.body.style.overflow = 'hidden';
  }

  function closeCodeModal() {
    codeModal.setAttribute('aria-hidden', 'true');
    codeModal.classList.remove('pg-code-modal--open');
    document.body.style.overflow = '';
  }

  document.getElementById('pg-view-code-btn')!.addEventListener('click', openCodeModal);
  document.getElementById('pg-code-modal-close')!.addEventListener('click', closeCodeModal);
  document.getElementById('pg-code-modal-backdrop')!.addEventListener('click', closeCodeModal);

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && codeModal.classList.contains('pg-code-modal--open')) {
      closeCodeModal();
    }
  });

  /* ── Advanced panel toggle ── */
  document.getElementById('pg-adv-toggle')!.addEventListener('click', () => {
    const isHidden = advPanel.hidden;
    advPanel.hidden = !isHidden;
    document.getElementById('pg-adv-toggle')!.classList.toggle('pg-adv-toggle--open', isHidden);
  });

  /* ── Helpers ── */
  function getPageTheme(): 'dark' | 'light' {
    return document.documentElement.dataset.theme === 'light' ? 'light' : 'dark';
  }

  function getActiveAccent(): string {
    return state.accent === 'custom' ? state.customColor : state.accent;
  }

  function isDefaultAccent(): boolean {
    return getActiveAccent() === '#6C5CE7';
  }

  function parseCaip(caip: string): { chainId: number; address: string } | null {
    const parts = caip.split(':');
    if (parts.length === 3 && parts[0] === 'eip155') {
      return { chainId: parseInt(parts[1], 10), address: parts[2] };
    }
    return null;
  }

  /* ── Sync theme buttons with page theme ── */
  function syncThemeButtons() {
    const theme = getPageTheme();
    root.querySelectorAll<HTMLButtonElement>('[data-theme-btn]').forEach(btn => {
      btn.classList.toggle('pg-pill--active', btn.dataset.themeBtn === theme);
    });
  }

  /* ── Widget lifecycle ── */
  function createWidget() {
    if (widget) {
      widget.destroy();
      widget = null;
    }

    const theme = getPageTheme();
    const accent = getActiveAccent();
    const colors = isDefaultAccent() ? undefined : { primary: accent };

    if (state.mode === 'swap') {
      const config: Record<string, unknown> = {
        theme,
        locale: state.language,
      };
      if (state.hideTitle) config.hideTitle = true;
      if (state.hidePoweredBy) config.hidePoweredBy = true;
      if (state.noBackground) config.noBackground = true;
      if (state.noBorder) config.noBorder = true;
      if (state.titleText.trim()) config.titleText = state.titleText.trim();
      if (state.titleImageUrl.trim()) config.titleImageUrl = state.titleImageUrl.trim();
      if (colors) config.customColors = colors;
      if (state.fromToken) config.fromToken = state.fromToken;
      if (state.toToken) config.toToken = state.toToken;

      widget = new TokenFlightSwap({
        container: mount,
        config: config as any,
        walletAdapter: walletAdapter ?? undefined,
      });
    } else {
      const parsed = parseCaip(state.targetToken);
      const target = parsed ?? { chainId: 8453, address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' };

      const config: Record<string, unknown> = {
        target,
        amount: state.amount,
        theme,
        locale: state.language,
      };
      if (state.hideTitle) config.hideTitle = true;
      if (state.hidePoweredBy) config.hidePoweredBy = true;
      if (state.noBackground) config.noBackground = true;
      if (state.noBorder) config.noBorder = true;
      if (state.titleText.trim()) config.titleText = state.titleText.trim();
      if (state.titleImageUrl.trim()) config.titleImageUrl = state.titleImageUrl.trim();
      if (colors) config.customColors = colors;

      widget = new TokenFlightReceive({
        container: mount,
        config: config as any,
        walletAdapter: walletAdapter ?? undefined,
      });
    }

    widget.initialize();
  }

  /* ── Code generation ── */
  const prismLangMap: Record<string, string> = {
    html: 'markup',
    react: 'jsx',
    vue: 'markup',
  };

  function highlight(code: string): string {
    const lang = prismLangMap[state.codeTab] || 'markup';
    const grammar = Prism.languages[lang];
    if (!grammar) return code.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    return Prism.highlight(code, grammar, lang);
  }

  function buildConfigLines(indent: string): string[] {
    const lines: string[] = [];
    const accent = getActiveAccent();

    if (state.language !== 'en-US') {
      lines.push(`${indent}locale: '${state.language}',`);
    }
    if (state.hideTitle) {
      lines.push(`${indent}hideTitle: true,`);
    }
    if (state.hidePoweredBy) {
      lines.push(`${indent}hidePoweredBy: true,`);
    }
    if (state.noBackground) {
      lines.push(`${indent}noBackground: true,`);
    }
    if (state.noBorder) {
      lines.push(`${indent}noBorder: true,`);
    }
    if (state.titleText.trim()) {
      lines.push(`${indent}titleText: '${state.titleText.trim()}',`);
    }
    if (state.titleImageUrl.trim()) {
      lines.push(`${indent}titleImageUrl: '${state.titleImageUrl.trim()}',`);
    }
    if (!isDefaultAccent()) {
      lines.push(`${indent}customColors: { primary: '${accent}' },`);
    }

    if (state.mode === 'swap') {
      if (state.fromToken) lines.push(`${indent}fromToken: '${state.fromToken}',`);
      if (state.toToken) lines.push(`${indent}toToken: '${state.toToken}',`);
    } else {
      const parsed = parseCaip(state.targetToken);
      if (parsed) {
        lines.push(`${indent}target: { chainId: ${parsed.chainId}, address: '${parsed.address}' },`);
      }
      lines.push(`${indent}amount: '${state.amount}',`);
    }

    return lines;
  }

  function buildDeclarativeTagAttrs(): { tag: string; attrs: string[] } {
    const tag = state.mode === 'swap' ? 'tokenflight-swap' : 'tokenflight-receive';
    const attrs: string[] = [];
    if (state.language !== 'en-US') attrs.push(`locale="${state.language}"`);
    if (state.hideTitle) attrs.push(`hide-title`);
    if (state.hidePoweredBy) attrs.push(`hide-powered-by`);
    if (state.noBackground) attrs.push(`no-background`);
    if (state.noBorder) attrs.push(`no-border`);
    if (state.titleText.trim()) attrs.push(`title-text="${state.titleText.trim()}"`);
    if (state.titleImageUrl.trim()) attrs.push(`title-image="${state.titleImageUrl.trim()}"`);

    if (state.mode === 'swap') {
      if (state.fromToken) attrs.push(`from-token="${state.fromToken}"`);
      if (state.toToken) attrs.push(`to-token="${state.toToken}"`);
    } else {
      attrs.push(`target='${JSON.stringify(parseCaip(state.targetToken))}'`);
      attrs.push(`amount="${state.amount}"`);
    }

    return { tag, attrs };
  }

  function buildSelfClosingTagLines(tag: string, attrs: string[], baseIndent = '  '): string[] {
    if (attrs.length === 0) {
      return [`${baseIndent}<${tag} />`];
    }

    const firstLine = `${baseIndent}<${tag}`;
    const attrLines = attrs.map((attr) => `${baseIndent}  ${attr}`);
    const lastLine = `${baseIndent}/>`;
    return [firstLine, ...attrLines, lastLine];
  }

  function genHTML(): string {
    const { tag, attrs } = buildDeclarativeTagAttrs();
    const tagLines = buildSelfClosingTagLines(tag, attrs, '');
    const lines = [
      `<script type="module">`,
      `  import { registerElements } from '@tokenflight/swap';`,
      `  registerElements();`,
      `<\/script>`,
      ``,
      ...tagLines,
    ];

    if (!isDefaultAccent()) {
      const accent = getActiveAccent();
      lines.push('');
      lines.push(`<script type="module">`);
      lines.push(`  // Apply custom accent color`);
      lines.push(`  const el = document.querySelector('${tag}');`);
      lines.push(`  el.setCustomColors({ primary: '${accent}' });`);
      lines.push(`<\/script>`);
    }

    return lines.join('\n');
  }

  function genReactDeclarative(): string {
    const { tag, attrs } = buildDeclarativeTagAttrs();
    const tagLines = buildSelfClosingTagLines(tag, attrs, '      ');

    if (isDefaultAccent()) {
      return [
        `import { registerElements } from '@tokenflight/swap';`,
        ``,
        `registerElements();`,
        ``,
        `export function Widget() {`,
        `  return (`,
        ...tagLines,
        `  );`,
        `}`,
      ].join('\n');
    }

    const accent = getActiveAccent();
    return [
      `import { useEffect, useRef } from 'react';`,
      `import { registerElements } from '@tokenflight/swap';`,
      ``,
      `registerElements();`,
      ``,
      `export function Widget() {`,
      `  const elRef = useRef<HTMLElement | null>(null);`,
      ``,
      `  useEffect(() => {`,
      `    elRef.current?.setCustomColors({ primary: '${accent}' });`,
      `  }, []);`,
      ``,
      `  return (`,
      ...tagLines.map((line, index) => {
        if (index === 0 && tagLines.length === 1) {
          return `      <${tag} ref={elRef} />`;
        }
        if (index === 0) {
          return `${line} ref={elRef}`;
        }
        return line;
      }),
      `  );`,
      `}`,
    ].join('\n');
  }

  function genReact(): string {
    if (state.codeUsage === 'declarative') {
      return genReactDeclarative();
    }

    const cls = state.mode === 'swap' ? 'TokenFlightSwap' : 'TokenFlightReceive';
    const configLines = buildConfigLines('      ');
    return [
      `import { useEffect, useRef } from 'react';`,
      `import { ${cls} } from '@tokenflight/swap';`,
      ``,
      `export function Widget() {`,
      `  const ref = useRef(null);`,
      ``,
      `  useEffect(() => {`,
      `    const w = new ${cls}({`,
      `      container: ref.current,`,
      `      config: {`,
      ...configLines,
      `      },`,
      `    });`,
      `    w.initialize();`,
      `    return () => w.destroy();`,
      `  }, []);`,
      ``,
      `  return <div ref={ref} />;`,
      `}`,
    ].join('\n');
  }

  function genVueDeclarative(): string {
    const { tag, attrs } = buildDeclarativeTagAttrs();
    const tagLines = buildSelfClosingTagLines(tag, attrs, '  ');

    if (isDefaultAccent()) {
      return [
        `<script setup>`,
        `import { registerElements } from '@tokenflight/swap';`,
        ``,
        `registerElements();`,
        `<\/script>`,
        ``,
        `<template>`,
        ...tagLines,
        `</template>`,
      ].join('\n');
    }

    const accent = getActiveAccent();
    return [
      `<script setup>`,
      `import { ref, onMounted } from 'vue';`,
      `import { registerElements } from '@tokenflight/swap';`,
      ``,
      `registerElements();`,
      `const el = ref(null);`,
      ``,
      `onMounted(() => {`,
      `  el.value?.setCustomColors({ primary: '${accent}' });`,
      `});`,
      `<\/script>`,
      ``,
      `<template>`,
      ...tagLines.map((line, index) => {
        if (index === 0 && tagLines.length === 1) {
          return `  <${tag} ref="el" />`;
        }
        if (index === 0) {
          return `${line} ref="el"`;
        }
        return line;
      }),
      `</template>`,
    ].join('\n');
  }

  function genVue(): string {
    if (state.codeUsage === 'declarative') {
      return genVueDeclarative();
    }

    const cls = state.mode === 'swap' ? 'TokenFlightSwap' : 'TokenFlightReceive';
    const configLines = buildConfigLines('      ');
    return [
      `<script setup>`,
      `import { ref, onMounted, onUnmounted } from 'vue';`,
      `import { ${cls} } from '@tokenflight/swap';`,
      ``,
      `const el = ref(null);`,
      `let widget;`,
      ``,
      `onMounted(() => {`,
      `  widget = new ${cls}({`,
      `    container: el.value,`,
      `    config: {`,
      ...configLines,
      `    },`,
      `  });`,
      `  widget.initialize();`,
      `});`,
      ``,
      `onUnmounted(() => widget?.destroy());`,
      `<\/script>`,
      ``,
      `<template>`,
      `  <div ref="el" />`,
      `</template>`,
    ].join('\n');
  }

  function updateCode() {
    let raw = '';
    switch (state.codeTab) {
      case 'html': raw = genHTML(); break;
      case 'react': raw = genReact(); break;
      case 'vue': raw = genVue(); break;
    }
    codeOutput.innerHTML = highlight(raw);
    copyLabel.textContent = 'Copy';
  }

  function getRawCode(): string {
    switch (state.codeTab) {
      case 'html': return genHTML();
      case 'react': return genReact();
      case 'vue': return genVue();
    }
    return '';
  }

  function syncCodeUsageControl() {
    const isDeclarativeSupported = state.codeTab === 'react' || state.codeTab === 'vue';
    codeUsageContainer.classList.toggle('pg-code-usage--disabled', !isDeclarativeSupported);
    codeUsageContainer.querySelectorAll<HTMLButtonElement>('[data-usage]').forEach(btn => {
      btn.disabled = !isDeclarativeSupported;
    });
  }

  /* ── Event wiring ── */

  // Mode pills
  root.querySelectorAll<HTMLButtonElement>('[data-mode]').forEach(btn => {
    btn.addEventListener('click', () => {
      const mode = btn.dataset.mode as 'swap' | 'receive';
      if (mode === state.mode) return;
      state.mode = mode;
      root.querySelectorAll<HTMLButtonElement>('[data-mode]').forEach(b => b.classList.remove('pg-pill--active'));
      btn.classList.add('pg-pill--active');
      document.getElementById('pg-swap-props')!.style.display = mode === 'swap' ? '' : 'none';
      document.getElementById('pg-receive-props')!.style.display = mode === 'receive' ? '' : 'none';
      createWidget();
      updateCode();
    });
  });

  // Theme pills
  root.querySelectorAll<HTMLButtonElement>('[data-theme-btn]').forEach(btn => {
    btn.addEventListener('click', () => {
      const theme = btn.dataset.themeBtn as 'light' | 'dark';
      // Toggle Starlight theme via the document attribute
      document.documentElement.dataset.theme = theme;
      // Also update the Starlight theme select if it exists
      const starlightSelect = document.querySelector('starlight-theme-select select') as HTMLSelectElement | null;
      if (starlightSelect) {
        starlightSelect.value = theme;
        starlightSelect.dispatchEvent(new Event('change'));
      }
      syncThemeButtons();
    });
  });

  // Accent dots
  root.querySelectorAll<HTMLInputElement>('input[name="pg-accent"]').forEach(radio => {
    radio.addEventListener('change', () => {
      state.accent = radio.value;
      if (radio.value === 'custom') {
        state.accent = 'custom';
      }
      const accent = getActiveAccent();
      if (widget) {
        widget.setCustomColors({ primary: accent });
      }
      updateCode();
    });
  });

  // Custom color picker
  const colorPicker = document.getElementById('pg-custom-color') as HTMLInputElement;
  colorPicker.addEventListener('input', () => {
    state.customColor = colorPicker.value;
    const customRadio = root.querySelector<HTMLInputElement>('input[name="pg-accent"][value="custom"]');
    if (customRadio) customRadio.checked = true;
    state.accent = 'custom';
    if (widget) {
      widget.setCustomColors({ primary: state.customColor });
    }
    updateCode();
  });

  // Language pills
  root.querySelectorAll<HTMLButtonElement>('[data-lang]').forEach(btn => {
    btn.addEventListener('click', () => {
      const lang = btn.dataset.lang!;
      if (lang === state.language) return;
      state.language = lang;
      root.querySelectorAll<HTMLButtonElement>('[data-lang]').forEach(b => b.classList.remove('pg-pill--active'));
      btn.classList.add('pg-pill--active');
      createWidget();
      updateCode();
    });
  });

  // Display toggle buttons
  const toggleMap: Record<string, keyof typeof state> = {
    'pg-toggle-title': 'hideTitle',
    'pg-toggle-badge': 'hidePoweredBy',
    'pg-toggle-bg': 'noBackground',
    'pg-toggle-border': 'noBorder',
  };

  Object.entries(toggleMap).forEach(([id, key]) => {
    const btn = document.getElementById(id)!;
    btn.addEventListener('click', () => {
      (state as any)[key] = !(state as any)[key];
      btn.classList.toggle('pg-pill--pressed', (state as any)[key]);
      createWidget();
      updateCode();
    });
  });

  // Title inputs
  document.getElementById('pg-title-text')!.addEventListener('input', (e) => {
    state.titleText = (e.target as HTMLInputElement).value;
    createWidget();
    updateCode();
  });

  document.getElementById('pg-title-image')!.addEventListener('input', (e) => {
    state.titleImageUrl = (e.target as HTMLInputElement).value;
    createWidget();
    updateCode();
  });

  // Swap props
  document.getElementById('pg-from-token')!.addEventListener('change', (e) => {
    state.fromToken = (e.target as HTMLSelectElement).value;
    createWidget();
    updateCode();
  });
  document.getElementById('pg-to-token')!.addEventListener('change', (e) => {
    state.toToken = (e.target as HTMLSelectElement).value;
    createWidget();
    updateCode();
  });

  // Receive props
  document.getElementById('pg-target-token')!.addEventListener('change', (e) => {
    state.targetToken = (e.target as HTMLSelectElement).value;
    createWidget();
    updateCode();
  });
  document.getElementById('pg-amount')!.addEventListener('change', (e) => {
    state.amount = (e.target as HTMLInputElement).value || '100';
    createWidget();
    updateCode();
  });

  // Code tabs
  root.querySelectorAll('.pg-code-tab').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = (btn as HTMLElement).dataset.tab as 'html' | 'react' | 'vue';
      state.codeTab = tab;
      root.querySelectorAll('.pg-code-tab').forEach(b => b.classList.remove('pg-code-tab--active'));
      btn.classList.add('pg-code-tab--active');
      syncCodeUsageControl();
      updateCode();
    });
  });

  codeUsageContainer.querySelectorAll<HTMLButtonElement>('[data-usage]').forEach(btn => {
    btn.addEventListener('click', () => {
      const usage = btn.dataset.usage as 'imperative' | 'declarative';
      if (usage === state.codeUsage) return;
      state.codeUsage = usage;
      codeUsageContainer.querySelectorAll('.pg-code-tab').forEach(b => b.classList.remove('pg-code-tab--active'));
      btn.classList.add('pg-code-tab--active');
      updateCode();
    });
  });

  // Copy
  copyBtn.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(getRawCode());
      copyLabel.textContent = 'Copied!';
      setTimeout(() => { copyLabel.textContent = 'Copy'; }, 1500);
    } catch {}
  });

  // Starlight dark/light toggle → sync widget + AppKit theme + our buttons
  const observer = new MutationObserver(() => {
    const theme = getPageTheme();
    if (widget) {
      widget.setTheme(theme);
    }
    syncAppKitTheme();
    syncThemeButtons();
    updateCode();
  });
  observer.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] });

  /* ── Init ── */
  syncThemeButtons();
  createWidget();
  syncCodeUsageControl();
  updateCode();
</script>

<style>
  /* ── Layout ── */
  .pg-playground {
    margin: 1rem 0 2rem;
  }

  /* ── Container ── */
  .pg-container {
    border: 1px solid var(--pg-border);
    border-radius: 20px;
    overflow: hidden;
    position: relative;
    background:
      radial-gradient(ellipse at 30% 30%, var(--sl-color-accent-low) 0%, transparent 60%),
      radial-gradient(ellipse at 70% 70%, var(--sl-color-accent-low) 0%, transparent 60%),
      var(--pg-surface);
  }

  .pg-container::before {
    content: '';
    display: block;
    height: 2px;
    background: linear-gradient(90deg, var(--sl-color-accent), var(--sl-color-accent-high), var(--sl-color-accent));
  }

  /* ── Widget (centered, prominent) ── */
  .pg-widget {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2.5rem 1rem 2rem;
    min-height: 460px;
  }

  .pg-widget-mount {
    width: 100%;
    max-width: 400px;
    filter: drop-shadow(0 8px 32px rgba(0, 0, 0, 0.12));
  }

  /* ── Controls Strip (RainbowKit-style) ── */
  .pg-strip {
    border-top: 1px solid var(--pg-border);
    padding: 14px 20px;
    display: flex;
    align-items: flex-end;
    gap: 20px;
    overflow-x: auto;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .pg-strip::-webkit-scrollbar {
    display: none;
  }

  .pg-group {
    flex-shrink: 0;
  }

  .pg-group--end {
    margin-left: auto;
    align-self: center;
  }

  .pg-label {
    display: block;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--pg-text-dim);
    margin-bottom: 6px;
    white-space: nowrap;
  }

  /* ── Pills (shared button group) ── */
  .pg-pills {
    display: flex;
    align-items: center;
    gap: 2px;
    padding: 3px;
    border-radius: 10px;
    background: var(--pg-input-bg);
    border: 1px solid var(--pg-border);
  }

  .pg-pill {
    padding: 5px 12px;
    border: 1px solid transparent;
    border-radius: 7px;
    background: transparent;
    color: var(--pg-text-secondary);
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    line-height: 1.2;
  }

  .pg-pill:hover {
    color: var(--pg-text);
    background: rgba(108, 92, 231, 0.06);
  }

  .pg-pill--active {
    color: #fff;
    background: var(--sl-color-accent);
    border-color: transparent;
    box-shadow: 0 1px 4px rgba(108, 92, 231, 0.3);
  }

  .pg-pill--active:hover {
    color: #fff;
    background: var(--sl-color-accent);
  }

  .pg-pill--sm {
    padding: 5px 8px;
    min-width: 28px;
    text-align: center;
  }

  .pg-pill--icon {
    padding: 5px 7px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Toggle buttons (display options) */
  .pg-pill--toggle {
    opacity: 0.45;
    position: relative;
  }

  .pg-pill--toggle::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + 6px);
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 8px;
    background: var(--pg-surface-raised, #1E2230);
    color: var(--pg-text, #E2E8F0);
    font-size: 11px;
    font-weight: 500;
    white-space: nowrap;
    border-radius: 6px;
    border: 1px solid var(--pg-border, #252A38);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s ease;
    z-index: 10;
  }

  .pg-pill--toggle:hover::after {
    opacity: 1;
  }

  .pg-pill--toggle:hover {
    opacity: 0.7;
  }

  .pg-pill--pressed {
    opacity: 1;
    color: var(--sl-color-accent);
    background: rgba(108, 92, 231, 0.1);
    border-color: rgba(108, 92, 231, 0.2);
  }

  .pg-pill--pressed:hover {
    background: rgba(108, 92, 231, 0.15);
  }

  /* ── Accent Dots ── */
  .pg-dots {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .pg-dot-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
  }

  .pg-dot-wrap input[type="radio"] {
    display: none;
  }

  .pg-dot {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    flex-shrink: 0;
    border: 2px solid transparent;
    transition: border-color 0.15s, box-shadow 0.15s, transform 0.15s;
    cursor: pointer;
  }

  .pg-dot:hover {
    transform: scale(1.1);
  }

  .pg-dot-wrap:has(input:checked) .pg-dot {
    border-color: var(--pg-text);
    box-shadow: 0 0 0 2px var(--pg-surface), 0 0 0 4px var(--pg-text-secondary);
  }

  .pg-dot--custom {
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--pg-input-bg);
    border: 2px dashed var(--pg-border);
    color: var(--pg-text-secondary);
  }

  .pg-dot--custom:hover {
    border-color: var(--pg-text-secondary);
    color: var(--pg-text);
  }

  .pg-color-picker {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    -webkit-appearance: none;
    border: none;
    padding: 0;
  }

  /* ── Code Button ── */
  .pg-code-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border: 1px solid var(--pg-border);
    border-radius: 10px;
    background: var(--pg-input-bg);
    color: var(--pg-text-secondary);
    font-size: 12px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    white-space: nowrap;
    transition: border-color 0.2s, color 0.2s, background 0.2s;
  }

  .pg-code-btn:hover {
    border-color: var(--sl-color-accent);
    color: var(--pg-text);
    background: rgba(108, 92, 231, 0.06);
  }

  /* ── Advanced Options Panel ── */
  .pg-advanced {
    border-top: 1px solid var(--pg-border);
    padding: 12px 20px;
    position: relative;
  }

  .pg-adv-inner {
    display: flex;
    flex-wrap: wrap;
    gap: 12px 24px;
  }

  .pg-adv-group {
    min-width: 200px;
  }

  .pg-adv-row {
    display: flex;
    gap: 8px;
  }

  .pg-adv-row .pg-select,
  .pg-adv-row .pg-input {
    flex: 1;
    min-width: 0;
  }

  .pg-select,
  .pg-input {
    width: 100%;
    height: 32px;
    padding: 0 10px;
    background: var(--pg-input-bg);
    border: 1px solid var(--pg-border);
    border-radius: 6px;
    color: var(--pg-text);
    font-size: 12px;
    font-family: inherit;
    outline: none;
    transition: border-color 0.15s;
  }

  .pg-select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    padding-right: 28px;
    background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 14 14" fill="none"%3E%3Cpath d="M3 5.25L7 9.25L11 5.25" stroke="%23C8CDD9" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/%3E%3C/svg%3E');
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 12px 12px;
  }

  .pg-select:focus,
  .pg-input:focus {
    border-color: var(--sl-color-accent);
  }

  .pg-adv-close {
    position: absolute;
    top: 12px;
    right: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    border: none;
    border-radius: 6px;
    background: transparent;
    color: var(--pg-text-dim);
    cursor: pointer;
    transition: color 0.15s, background 0.15s;
  }

  .pg-adv-close:hover {
    color: var(--pg-text);
    background: var(--pg-hover);
  }

  /* ── Advanced Toggle Button ── */
  .pg-adv-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    width: 100%;
    padding: 8px;
    border: none;
    border-top: 1px solid var(--pg-border);
    border-radius: 0 0 20px 20px;
    background: transparent;
    color: var(--pg-text-dim);
    font-size: 11px;
    font-weight: 500;
    font-family: inherit;
    cursor: pointer;
    transition: color 0.15s, background 0.15s;
  }

  .pg-adv-toggle:hover {
    color: var(--pg-text-secondary);
    background: var(--pg-hover);
  }

  .pg-adv-toggle svg {
    transition: transform 0.2s;
  }

  .pg-adv-toggle--open svg {
    transform: rotate(180deg);
  }

  /* ── Code Modal ── */
  .pg-code-modal {
    position: fixed;
    inset: 0;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease;
  }

  .pg-code-modal--open {
    opacity: 1;
    visibility: visible;
  }

  .pg-code-modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
  }

  .pg-code-modal-content {
    position: relative;
    width: 90%;
    max-width: 720px;
    max-height: 80vh;
    border-radius: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    background: #0D0F14;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 24px 80px rgba(0, 0, 0, 0.5);
    transform: translateY(10px) scale(0.98);
    transition: transform 0.2s ease;
  }

  .pg-code-modal--open .pg-code-modal-content {
    transform: translateY(0) scale(1);
  }

  .pg-code-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.03);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  }

  .pg-code-modal-actions {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .pg-code-modal-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border: none;
    border-radius: 8px;
    background: transparent;
    color: rgba(255, 255, 255, 0.4);
    cursor: pointer;
    transition: background 0.15s, color 0.15s;
  }

  .pg-code-modal-close:hover {
    background: rgba(255, 255, 255, 0.08);
    color: rgba(255, 255, 255, 0.8);
  }

  .pg-code-bar-left {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 0;
  }

  .pg-code-tabs {
    display: flex;
    align-items: center;
    gap: 2px;
    background: rgba(255, 255, 255, 0.04);
    border-radius: 100px;
    padding: 2px;
  }

  .pg-code-tab {
    padding: 6px 12px;
    border: none;
    border-radius: 100px;
    background: transparent;
    color: rgba(255, 255, 255, 0.4);
    font-size: 13px;
    font-weight: 500;
    font-family: inherit;
    line-height: 1;
    cursor: pointer;
    transition: background 0.12s, color 0.12s;
  }

  .pg-code-tab:hover {
    color: rgba(255, 255, 255, 0.7);
  }

  .pg-code-tab--active {
    background: var(--sl-color-accent);
    color: #fff;
  }

  .pg-code-usage {
    margin-left: 4px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    transition: opacity 0.15s;
  }

  .pg-code-usage--disabled {
    opacity: 0.4;
    pointer-events: none;
  }

  .pg-copy-btn {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.25rem 0.5rem;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 5px;
    background: transparent;
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.6875rem;
    font-family: inherit;
    cursor: pointer;
    transition: color 0.15s, border-color 0.15s;
  }

  .pg-copy-btn:hover {
    color: rgba(255, 255, 255, 0.8);
    border-color: rgba(255, 255, 255, 0.15);
  }

  .pg-code-scroll {
    flex: 1;
    overflow: auto;
    padding: 0.75rem 1rem;
    min-height: 200px;
    max-height: 60vh;
  }

  .pg-pre {
    margin: 0;
    white-space: pre;
    font-family: 'JetBrains Mono', var(--sl-font-mono);
    font-size: 0.8125rem;
    line-height: 1.65;
    color: #ABB2BF;
  }

  .pg-pre code {
    background: none;
    font-family: inherit;
    font-size: inherit;
    padding: 0;
    border: none;
  }

  /* Prism One Dark Pro theme */
  .pg-pre :global(.token.comment),
  .pg-pre :global(.token.prolog),
  .pg-pre :global(.token.doctype),
  .pg-pre :global(.token.cdata) { color: #5C6370; font-style: italic; }

  .pg-pre :global(.token.punctuation) { color: #ABB2BF; }

  .pg-pre :global(.token.tag) { color: #E06C75; }
  .pg-pre :global(.token.selector) { color: #E06C75; }

  .pg-pre :global(.token.attr-name) { color: #D19A66; }

  .pg-pre :global(.token.string),
  .pg-pre :global(.token.char),
  .pg-pre :global(.token.attr-value),
  .pg-pre :global(.token.template-string) { color: #98C379; }

  .pg-pre :global(.token.keyword) { color: #C678DD; }
  .pg-pre :global(.token.operator) { color: #C678DD; }

  .pg-pre :global(.token.boolean),
  .pg-pre :global(.token.number),
  .pg-pre :global(.token.constant) { color: #D19A66; }

  .pg-pre :global(.token.function),
  .pg-pre :global(.token.class-name) { color: #61AFEF; }

  .pg-pre :global(.token.script) { color: #ABB2BF; }

  .pg-pre :global(.token.attr-value .token.punctuation) { color: #98C379; }

  /* ── Responsive ── */
  @media (max-width: 767px) {
    .pg-container {
      border-radius: 14px;
    }

    .pg-widget {
      min-height: 420px;
      padding: 1.5rem 0.75rem;
    }

    .pg-strip {
      padding: 10px 12px;
      gap: 14px;
    }

    .pg-code-modal-content {
      width: 95%;
      max-height: 85vh;
    }

    .pg-code-modal-header {
      flex-wrap: wrap;
      gap: 8px;
    }

    .pg-advanced {
      padding: 10px 12px;
    }

    .pg-adv-row {
      flex-direction: column;
    }
  }
</style>
