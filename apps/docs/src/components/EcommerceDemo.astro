---
/**
 * Mock e-commerce checkout page with an embedded TokenFlight receive widget.
 * Demonstrates how a crypto payment option integrates into a checkout flow.
 */
---

<div class="ec-demo not-content">
  <!-- Store header -->
  <div class="ec-header">
    <div class="ec-header-left">
      <div class="ec-store-logo">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg>
      </div>
      <span class="ec-store-name">CryptoStore</span>
    </div>
    <div class="ec-header-right">
      <div class="ec-cart-badge">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 002 1.61h9.72a2 2 0 002-1.61L23 6H6"/></svg>
        <span class="ec-cart-count">1</span>
      </div>
    </div>
  </div>

  <!-- Checkout content -->
  <div class="ec-content">
    <!-- Steps indicator -->
    <div class="ec-steps">
      <span class="ec-step ec-step--done">Cart</span>
      <span class="ec-step-sep"></span>
      <span class="ec-step ec-step--done">Shipping</span>
      <span class="ec-step-sep"></span>
      <span class="ec-step ec-step--active">Payment</span>
    </div>

    <!-- Order summary -->
    <div class="ec-order">
      <div class="ec-order-header">Order Summary</div>
      <div class="ec-order-item">
        <div class="ec-item-img">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="4"/><circle cx="8" cy="8" r="2"/><path d="M2 16l5-5 4 4 3-3 8 8"/></svg>
        </div>
        <div class="ec-item-info">
          <span class="ec-item-name">Phantom Hoodie — Black</span>
          <span class="ec-item-meta">Size: L &middot; Qty: 1</span>
        </div>
        <span class="ec-item-price">$89.00</span>
      </div>
      <div class="ec-order-totals">
        <div class="ec-total-row">
          <span>Subtotal</span><span>$89.00</span>
        </div>
        <div class="ec-total-row">
          <span>Shipping</span><span class="ec-free">Free</span>
        </div>
        <div class="ec-total-row ec-total-row--final">
          <span>Total</span><span>$89.00</span>
        </div>
      </div>
    </div>

    <!-- Payment section -->
    <div class="ec-payment">
      <div class="ec-payment-header">
        <span class="ec-payment-title">Pay with Crypto</span>
        <span class="ec-payment-badge">Any Chain</span>
      </div>
      <div class="ec-mount" data-widget="receive"></div>
    </div>
  </div>
</div>

<script>
  import { TokenFlightReceive, registerElements } from '@tokenflight/swap';
  import { getWalletAdapter } from '../lib/appkit';

  registerElements();

  const walletAdapter = await getWalletAdapter();

  document.querySelectorAll('.ec-demo').forEach((root) => {
    const el = root as HTMLElement;
    const receiveMount = el.querySelector('[data-widget="receive"]') as HTMLElement | null;

    if (receiveMount) {
      const receive = new TokenFlightReceive({
        container: receiveMount,
        config: {
          target: { chainId: 8453, address: '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913' },
          amount: '89',
          theme: 'dark',
          locale: 'en-US',
          hideTitle: true,
        },
        walletAdapter: walletAdapter ?? undefined,
        callbacks: {
          onSwapSuccess: (data: unknown) => console.log('Payment success:', data),
          onSwapError: (data: unknown) => console.log('Payment error:', data),
        },
      });
      receive.initialize();
      receive.setCustomColors({
        primary: '#00b894',
        'accent-light': 'rgba(0, 184, 148, 0.1)',
        'accent-glow': 'rgba(0, 184, 148, 0.2)',
      });
    }
  });
</script>

<style>
  /* ── E-Commerce Shell ───────────────────────────────────────────── */
  .ec-demo {
    max-width: 420px;
    margin: 1.5rem auto;
    background: #0E1117;
    border-radius: 16px;
    border: 1px solid #1E2430;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: #E7E9EA;
    display: flex;
    flex-direction: column;
  }

  /* ── Header ──────────────────────────────────────────────────────── */
  .ec-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    background: #161B22;
    border-bottom: 1px solid #1E2430;
    flex-shrink: 0;
  }

  .ec-header-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .ec-store-logo {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: linear-gradient(135deg, #00b894, #55efc4);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
  }

  .ec-store-name {
    font-size: 15px;
    font-weight: 700;
    color: #E7E9EA;
  }

  .ec-header-right {
    display: flex;
    align-items: center;
  }

  .ec-cart-badge {
    position: relative;
    color: #8B949E;
    padding: 4px;
  }

  .ec-cart-count {
    position: absolute;
    top: -2px;
    right: -4px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #00b894;
    color: #fff;
    font-size: 10px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* ── Content ─────────────────────────────────────────────────────── */
  .ec-content {
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  /* ── Steps ───────────────────────────────────────────────────────── */
  .ec-steps {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .ec-step {
    font-size: 12px;
    font-weight: 600;
    color: #484F58;
  }

  .ec-step--done {
    color: #00b894;
  }

  .ec-step--active {
    color: #E7E9EA;
    background: rgba(0, 184, 148, 0.12);
    padding: 3px 10px;
    border-radius: 10px;
  }

  .ec-step-sep {
    width: 20px;
    height: 1px;
    background: #2D333B;
  }

  /* ── Order summary ───────────────────────────────────────────────── */
  .ec-order {
    background: #161B22;
    border-radius: 12px;
    border: 1px solid #1E2430;
    overflow: hidden;
  }

  .ec-order-header {
    padding: 10px 14px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #8B949E;
    border-bottom: 1px solid #1E2430;
  }

  .ec-order-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    border-bottom: 1px solid #1E2430;
  }

  .ec-item-img {
    width: 44px;
    height: 44px;
    border-radius: 8px;
    background: #21262D;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #484F58;
    flex-shrink: 0;
  }

  .ec-item-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
    min-width: 0;
  }

  .ec-item-name {
    font-size: 13px;
    font-weight: 600;
    color: #E7E9EA;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .ec-item-meta {
    font-size: 12px;
    color: #8B949E;
  }

  .ec-item-price {
    font-size: 14px;
    font-weight: 700;
    color: #E7E9EA;
    flex-shrink: 0;
  }

  /* ── Totals ──────────────────────────────────────────────────────── */
  .ec-order-totals {
    padding: 10px 14px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .ec-total-row {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    color: #8B949E;
  }

  .ec-total-row--final {
    padding-top: 6px;
    border-top: 1px solid #1E2430;
    font-weight: 700;
    font-size: 15px;
    color: #E7E9EA;
  }

  .ec-free {
    color: #00b894;
    font-weight: 600;
  }

  /* ── Payment section ─────────────────────────────────────────────── */
  .ec-payment {
    background: #161B22;
    border-radius: 12px;
    border: 1px solid #1E2430;
    overflow: hidden;
  }

  .ec-payment-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 14px;
    border-bottom: 1px solid #1E2430;
  }

  .ec-payment-title {
    font-size: 13px;
    font-weight: 700;
    color: #E7E9EA;
  }

  .ec-payment-badge {
    font-size: 11px;
    font-weight: 600;
    color: #00b894;
    background: rgba(0, 184, 148, 0.1);
    border: 1px solid rgba(0, 184, 148, 0.2);
    padding: 2px 8px;
    border-radius: 10px;
  }

  .ec-mount {
    min-height: 380px;
    display: flex;
    justify-content: center;
  }
</style>
